# Mood Miner – Emotion Classifier with Empathetic LLM Chatbot

## 🌟 Overview
Mood Miner is a lightweight NLP pipeline that classifies user-written text by emotional tone and provides an empathetic chatbot response using Google's Gemini API. Built without any pretrained language models for emotion detection, it ensures privacy and performance on local machines.

## ✨ UI/UX Enhancements
The application features a dynamic and responsive user interface, compatible with both mobile and desktop devices. Key UI/UX updates include:
- **Theming:** Implemented a light and dark mode with carefully selected gradient colors for a modern aesthetic.
- **Logo Integration:** The Mood Miner logo is prominently displayed in both the sidebar and the main chat interface.
- **Chat Experience:** The chat input field has been refined with improved styling, and the chat history now displays messages in a natural, chronological order (newest at the bottom). A "New Chat" button has been added for convenience.
- **Accessibility:** Color contrast ratios are maintained above 4.5:1 for all text elements to ensure readability across themes.

## 🧠 Features
- Emotion detection from text (joy, sadness, fear, anger, love, surprise, neutral, mixed)
- Locally trained ML model using TF-IDF and Logistic Regression
- **Incremental Model Training:** The model can be incrementally trained with new datasets to improve accuracy and diversify detection capabilities.
- Gemini API integration for empathetic replies
- All suggestions, quotes, songs, and activities are generated by the LLM
- Secure API usage through environment variables

## 💾 How It Works
1. **Data Consolidation:** Datasets from `data/` and `data/New Data/` are combined into unified training, validation, and test sets.
2. **Train/Retrain Model:** A local emotion classification model is trained or incrementally retrained on the consolidated, diverse dataset.
3. **Detect Emotion:** The user's emotion in a text input is detected using this model. If model confidence is low, it returns 'neutral'.
4. **Generate Response:** The query + emotion is sent to Gemini for an emotional, context-aware response. All suggestions are generated by the LLM.
5. **Display Chat:** The conversation is displayed in a chat-like interface with new messages appearing at the bottom.

## 🔐 API Security
Place your Gemini API key in a `.env` file as:

```
GEMINI_API_KEY=your_api_key_here
```

**Important:** Only your API key should be in `.env`. Do not put code or .gitignore lines in `.env`.

Add `.env` to your `.gitignore` file (not in `.env`):
```
# .gitignore
.env
```

### 🔒 Security Best Practices
* **Never share your `.env` file or API key.**
* **Add `.env` to your `.gitignore` file:**
  See above for correct usage.
* **Always use environment variables for secrets.**
* **Do not hard-code API keys in code, notebooks, or scripts.**
* For extra protection, consider using secret management tools or encrypting environment files if sharing with collaborators.

## ▶️ Running the Application
To run the Streamlit chat interface:
```bash
streamlit run moodminerchatapp.py
```
To train or incrementally retrain the model:
```bash
python train_model.py
```
To combine datasets:
```bash
python combine_datasets.py
```

## 📦 File Structure
```
mood_miner/
├── main.ipynb           # Modular code with commentary
├── MoodMiner.ipynb      # All-in-one executable notebook
├── moodminerchatapp.py  # Streamlit chat app (LLM suggestions only)
├── train_model.py       # Script for training/retraining the model
├── combine_datasets.py  # Script for combining datasets
├── README.md            # Documentation
├── requirements.txt     # Dependencies
└── data/
    ├── train.txt        # Combined training set (semicolon-separated: text;emotion)
    ├── val.txt          # Combined validation set (semicolon-separated: text;emotion)
    ├── test.txt         # Combined test set (semicolon-separated: text;emotion)
    └── New Data/        # Original new data files
        ├── test.csv
        ├── training.csv
        └── validation.csv
```

## 📘 Dataset

The application uses a combined dataset for training. The original datasets are located in the `data/` and `data/New Data/` folders. The `combine_datasets.py` script consolidates these into `train.txt`, `val.txt`, and `test.txt` in the `data/` folder.

## 📌 Important Notes for GitHub
* Place `.env` in `.gitignore`
* NEVER hard-code `GEMINI_API_KEY`
* Use `python-dotenv` to safely manage secrets

## 🛠️ Setup Instructions

### 1. Create and Activate Virtual Environment
```bash
python -m venv .venv
source .venv/bin/activate       # or .venv\Scripts\activate on Windows
```

### 2. Install Dependencies
```bash
pip install --upgrade pip
pip install -r requirements.txt
python -m nltk.downloader stopwords punkt punkt_tab
python -m spacy download en_core_web_sm
```

### 3. Prepare Dataset
Run `python combine_datasets.py` to consolidate the datasets.

### 4. Train Model
Run `python train_model.py` to train or incrementally retrain the emotion detection model.

### 5. Run Application
Run `streamlit run moodminerchatapp.py` to start the chat interface.

---

## ✅ Final Output Summary
* `README.md`: Full documentation with updated UI/UX, data handling, and training process.
* `main.ipynb`: Modular with inline comments, error handling, and code blocks
* `MoodMiner.ipynb`: Full executable version with GUI + Gemini integration
* `moodminerchatapp.py`: Streamlit GUI chat interface with emotion-based empathetic LLM responses and enhanced UI/UX.
* `train_model.py`: Script for training/retraining the model.
* `combine_datasets.py`: Script for combining datasets.
* `requirements.txt`: All required libraries
* Uses `.env` for secret safety
* Final cell: Streamlit GUI chat interface with emotion-based empathetic LLM responses (no local suggestions)
* Reads train.txt, val.txt, test.txt from data/ and uses robust preprocessing, evaluation, and visualizations

📊 Model Evaluation Results
Below are the visual results from the model evaluation process, including accuracy scores, precision/recall metrics, and the confusion matrix for emotion classification.

✅ Evaluation Metrics

precision    recall  f1-score   support

       anger       0.89      0.79      0.83       275
        fear       0.87      0.82      0.85       224
         joy       0.84      0.95      0.89       695
        love       0.82      0.58      0.68       159
     sadness       0.88      0.92      0.90       581
    surprise       0.85      0.52      0.64        66

    accuracy                           0.86      2000
   macro avg       0.86      0.76      0.80      2000
weighted avg       0.86      0.86      0.86      2000

🖼️ Visual Outputs

confusion matrix.png